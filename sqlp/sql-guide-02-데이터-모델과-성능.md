## 데이터 모델과 성능
#### 1절 성능 데이터 모델링의 개요
* 일반적인 성능 == 데이터 조회 성능
* 성능 저하 이유
  * 모델 구조
  * 데이터의 용량
  * 인덱스의 특성을 고려하지 않은 인덱스 생성
* **성능 데이터 모델링** 이란 디비 성능향상을 목적으로 설계단계의 데이터 모델링때부터 성능을 고려해하는 것이다.
###### 성능 데이터 모델링 고려사항
* 데이터 모델링할때 정규화를 정확하게
* 디비 용량산성
* 디비에 발생된느 트랜잭션 유형 파악
* 용량과 트랜잭션 유형에 따라 반정규화
* 이력모델 조정, pk/fk 조정 , 슈퍼타입/서브타입 조정등 수행
* 성능 관점에서 데이터 모델 검증

#### 2절 정규화와 성능
* 정규화는 데이터 중복을 제거하고 관심사별로 처리되는 경우가 많아 성능이 향상되는 특징이 있지만 sql에서 조인이 많이 발생해 성능저하를 초래할수도 있어 반정규화를 적용하는 전략이 필요하다.
* 정규화의 수행은 입력/수정/삭제 성능에선 데이터 중복이 없어 테이블 용량이 최소화 되어 성능이 향상되지만 조회성능에선 처리조건에 따라 성능이 향상될 수도 저하될 수도 있다.

###### 사례
* PK Unique Index를 이용하면 조인 성능 저하를 대처할수있다.
* 반정규화된 테이블엔 데이터가 많기 때문에 데이터가 많은데서 조회하는것보다, 정규화된 데이터양이 적은 테이블에서 조회하는 것이 성능이 좋을 수도 있다.
* 한 테이블에 인덱스가 많은면 조회 성능은 좋아지지만 입력,수정,삭제기능은 저하된다.

###### 함수적 종속성
* 함수적 종속성은 데이터들이 어떤 기준값에 의해 종속되는 현상을 지칭. 기준값을 결정자, 종속값을 종송자라고 한다.

#### 3절 반정규화와 성능
* 반정규화는 성능을 향상시키기 위해 정규화된 데이터 모델에서 중복, 통합, 분리 등을 수행하는 모든 과정을 의미한다.
* 반정규화를 무분별하게 진행하면 데이터 무결성을 깨드리때문에 다른 방법을 고려한 후 반정규화를 적용해야한다.

###### 반정규화 전에 고려해야할 다른 방법
* 많은 조인이 걸려 데이터 조회가 어려울 경우 뷰(VIEW)를 사용해 문제를 해결한다. 뷰가 조회 성능 향상을 야기하진 않지만 개발자의 SQL작성 능력에 따라 성능저하가 나타날 수 있기 때문에 개발자가 뷰를 통해 접근하게 해 위험을 예방한다
* 대량의 데이터처리 또는 부분 처리에 의해 성능 저하가 이렁나는 경우 클러스터링을 적용하거나 인덱스를 조정한다.
* 대량의데이터는 primary key의 성격에 따라 부분적인 테이블로 분리한다. 파티셔닝 기법을 적용해 성능저하 방지한다.
* 응용 어플리케이션 로직을 구하는 방법을 변경하면서 성능을 향상한다. 예를들어 캐시 공유한다거나.

###### 반정규화 기법
* 테잉블 반정규화
 * 테이블 병합, 테이블 분할, 테이블 추가
* 칼럼 반정규화
 * 중복 칼럼 추가, 파생칼럼추가, 이력테이블 칼럼 추가, PK에 의한 칼럼추가
* 관계반정규화
 * 중복관계 추가

#### 4절 대량 데이터에 따른 성능
* 하나의 테이블에 대량의 데이터가 있다면 인덱스의 tree구조가 커서 데이터 처리할때 디스트 I/O를 많이 유발해 성능이 저하된다.
* 로우 체이닝 : 로우 길이가 길어 데이터 블록 하나에 데이터가 모두 저장되지 않고 두개 이상의 불로게 걸쳐 하나의 로우가 저장되어 있는 형태
* 로우 마이그레이션 : 데이터 블록에서 수정이 발생하면 수정된 데이터를 해당 데이터 블록에서 저장하지 못하고 다른 블록의 빈 공간을 찾아 저장하는 방식.
* 로우 체이닝과 로우 마이그레이션이 발생해 많은 블록에 데이터 저장되면 불필요한 IO가 많아져 성능이 저하된다.

* 한 테이블에 칼럼이 많은 경우 : 칼럼이 많은 테이블에서 데이터를 처리하게 되면 디스크 I/O양이 증가하여 성능이 저하된다. 잘 쪼개야한다
* 데이터가 아주 많아질 경우에는 논리적으로는 하나의 테이블로 보지만 물리적으로는 여러개의 테이블로 쪼개 저장되는 구조의 파티셔닝을 적용해야한다. range partition, list partition, hash partition이 있다.

#### 5절 데이터베이스 구조와 성능
* 공통의 부분을 슈퍼타입 모델링으로 추출하고 , 공통을 상속받고 다른 엔티티과 차이가 있는 속성에 대해서는 서브 엔티티를 둔다. 이는 분석단계에 주로 쓰인다. 이런경우 데이터 모델링은 데이터의 양과 트랜잭션의 유형에 따라 각 개별 테이블로 구성하는 방식, 슈퍼타입+서브타입 테이블로 구성하는 방식 하나의 테이블로 구성하는 방식으로 이뤄진다.
* PK는 Unique Index를 자동으로 생성한다. 복합키인경우 PK의 순서는 Index의 순서가 됨으로 PK의 순서가 성능 저하를 방지할수 있는 방법이 될 수 있다. PK가 앞쪽에 있을 수록  인덱스 효율이 좋다.

#### 6절 분산 데이터베이스와 성능
* 분산 데이터베이스는 네트워크 환경으 ㄹ이용해 디비를 여러 지역, 여러 노드로 위치시켜 성능을 극대화 시킨 데이터 베이스다.
* 분산 디비의 장점 : 점증적 용량 확장, 신회성, 가용성, 효용성, 속도, 통신 비용 절감,
* 분산 디비의 단점 : 개발비용 증가, 오류가능성, 비용증가, 설계 관리 복잡도, 데이터 무결성 위협

##### 분산 구성 적용
* 테이블 위치 분산 : 테이블 구조를 변하지않고 디비에 중복되어 생성되지도 않고 설계된 테이블의 위치를 다르게 위치시키는 것.
* 테이블 분할 분산 : 각 테이블을 분산하는 방법. 수평분할, 수직 분할
* 테이블 복제 분산 : 동일한 테이블을 다른 지역이나 서버에서 동시에 생성하여 관리하는 유형. 마스터 디비에서 테이블의 일부만 다른 지역 디비 서버에 위치시키는 것이 부분복제, 그리고 마스터 디비 테이블 내용을 각 지역 서버에 존재시키는 것이 광역복제다.
* 테이블 요약 분산 : 동일한 테이블 구조를 가지며 분산되어 있는 동일한 내용의 데이트를 이용하여 통합된 데이터를 산출하는 방식의 분석요약과 분산돼있는 다른 내용의 데이터를 이용해 통합된 데이터를 산출하는 방식의 통합요약이있다.

### 2장 요약
제 2장은 디비 성능을 고려한 데이터 모델링이다. 정규화,반정규화를 통한 성능 개선 방법, 대량 데이터를 다룰때 개선 방법, 디비 구조 개선을 통해, 분산 디비 환경을 통한 성능 개선에 대해 구체적인 사례와 함께 배웠다. 데이터 베이스 성능은 디비 모델링에서부터 고려되는것이  비용을 줄이는 최선의 방법이기 때문에 데이터 모델링의 과정에서 꼭 필요한 과정이다.
