# Transaction 
트랜잭션은 ACID를 보장해야한다.

## 원자성 Atomictity

트랜잭션내에서 실행한 작업은 마지 하나의 작업인것 처럼 모두 성공하거나 모두 실패해야한다.

## 일관성 Consistency

모든 트랜잭션은 일관성있는 데이터베이트 상태를 유지해야한다. 데이터 베이스에서 정한 무결성 제약조건을 항상 만족해야한다

## 격리성 Isolation

하나의 트랜젝션은 실행중인데 commit되지 않은 데이터가 있을때 다른 트랜젝션으로 부터 고립된 상태로 있어야한다

동시에 실행되는 트랜잭션ㅇ들이 서로에게 영향을 미지치 않도록 격리한다. 

## 지속성 Durablity

커밋된 데이터는 모든 데이터는 정확한 상태로 보존되어 사용자에게 전달되어야한다. 

트랜잭션을 성공적으로 끝ㄴ나면 그 결과가 항상 기록 되어야 한다.

## 트랜잭션 격리수준

### READ UNCOMMITTED

커밋하지 않은 데이터를 읽을 수 있다. 

예를들어 트랜잭션1이 데이터를 수정하고 있는데, 커밋하지 않아도 트랜잭션2가 수정중인 데이터를 조회할 수 있다. 이를 **DIRTY READ**  라고 한다. 

트랜잭션2가 DIRTY READ한 데이터를 사용하는데 트랜잭션1을 롤백하면 데이터 정합성이 깨질 수 있다. 

**DIRTY READ를 허용하는 격리수준** 

### READ COMMITTED

커밋한 데이터만 읽을 수 있다.

따라서 DIRTY READ가 발생하지 않는다. 하지만 NON-REPEATABLE READ는 발생할 수 있다. 

예를들어 트랜잭션 1이 회원 A를 조회 중인데 갑자기 트랜잭션 2가 회원 A를 수정하고 커밋하면 트랜잭션 1이 다시 회원 A를 조회했을때 수정된 데이터가 조회된다.

이처럼 반복해서 같은 데이터를 읽을 수 없는 상태를 **NON REPEATABLE READ** 라고 한다.

### REPEATABLE READ

한 번 조회한 데이터를 반복해서 조회해도 같은 데이터가 조회된다.

하지만 **PHANTOM READ**는 발생할 수 있다. 

예를들어 트랜잭션 1이 10살 이하의 회원을 조회했는데, 트랜잭션 2가 5살 회원을 추가하고 커밋하면 트랜잭션 1이 다시 10살 이하의 회원을 조회했을 때 회원 하나가 추가된 상태로 조회된다.

반복 조회 시 결과 집합이 달라지는것을 **PHANTOM READ** 라 한다.

NON REPEATABLE READ는 허용하지 않지만 PHANTOM READ는 허용하는 격리 수준.

## SERIALIZABLE

가장 엄격한 트랜잭션 격리 수준이다. 

여기서는 PHANTOM READ가 발생하지 않는다. 하지만 동시성 처리 성능이 급격히 떨어질 수 있다.