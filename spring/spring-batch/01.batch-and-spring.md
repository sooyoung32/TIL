# 01. 배치와 스프링

### 배치 처리시 좋은 이유

- 배치 처리를 이용하면 실제 처리 시작되기 전에 필요한 정보를 미리 수집 가능
- 자원을 효율적으로 사용가능
    - 시간이 많이 걸리는 작업을 미리 배치처리해 수행후 실시간으로 사용하게 하는 경우도 있다.

### 배치 처리 역사

- **배치처리는 상호작용이나 중단없이 유한한 양의 데이터를 처리하는것으로 정의**
- 배치처리가 시작되면 아무런 개입없이 어떤 형대로든 완료됨.
- 처음 배치 처리 평정은 코볼  → 코볼 실행 서버가 비싸고 리소스도 부족해지고..
- 액센추어 (배치 경험 많음) +  스프링과 결합해 프레임워크 만들기로 결심
- 2008 스프링 배치 1.0.0 출시
- 2014 3.0.0 버전에 새로운 자바 배치 표준인 JSR-352 구현

### 배치가 직면한 과제

배치 처리는 처리 부하를 예측하고 그에맞게 설계할 수 있기 때문에 사용량 급중 문제와 사용자 중심에러처리는 예측 가능 → 확실한 로그와 프드백용 알림만 사용해 신속, 정확하게 에러를 발생하면 됨!

### 배치 특성

- 사용성, 유지보수성, 기능확장성 모두 연관되어 있음
    - 배치처리에 사용성은 코드에 관한 것 → 유지보수에 관한 것
        - 새로운 기능을 쉽게 추가할수 있는가?
        - 단위테스트가 잘 마련되어 있는가?
        - 실패 사유를 알 수 있는가?
- 가용성
    - 배치 처리시 보통 약속이 정해져 있고, 대부분 필요한 리소스를 언제 사용할수 있는지 알고 있는 상태에서 주어진 시간에 잡이 실행되도록 에약
    - 필요할 때 바로 배치 처리 수행할 수 있는가? 시간내 수행하여 다른 시스템에 영향을 주지 않는가?
- 보안
    - 데이터를 안전하게 저장하는것
        - 민감한 데이터 암호화가 되어있는가?
        - 개인정보를 로깅하지 않는가?

### 왜 자바로 배치 처리하는가?

- 유지보수성, 유연성, 확장성, 개발리소스, 지원, 비용 면에서 생각해보자
- 유지보수성
    - 배치 코드는 일반 코드보다 수명이 길다
    - 스프링 프레임워크의 장점을 이용할 수 있다
        - 테스트 용이성, 추상화, DI 등등
- 유연성
    - JVM 플랫폼에서 자유롭게 사용 가능 WORA
- 확장성
    - 스프링 배치에서 확장성
        - 단일 서버 내 단일 JVM에서 배치 처리 수행 가능
        - 특정 날에만 클라우드 리소스 활용해 확장 가능
        - 데이터 신뢰성도 같이 챙길 수 있음
- 개발 리소스
    - 스프링 다룬 사람이라면 OK
- 비용
    - 오픈소스

### 이용 사례

- ETL  Extract, Transform, Load 추출 변환 적재
- 데이터 마이그레이션
- 병렬 처리
- 워크로드 조정
- 무중단 처리, 상시 데이터 처리

### 스프링 배치 프레임 워크

- 3개의 레이어로 구성됨
    - 어플리케이션
        - 배치 처리구축에 사용되는 사용자 코드 및 구성
        - 비즈니스 로직, 잡 구조화 구성 등
    - 코어
        - 배치 도메인을 정의하는 모든 부분
        - Job, Step, JobLauncher...
    - 인프라 스트럭쳐
        - 잡 수행에 실패한 이후 재시도될 때 어떤일을 수행할지 → 공통 인프라스트럭쳐

### 스프링으로 잡 정의

- 잡은 중단이나 상호작용 없이 처음부터 끝까지 실행되는 처리
- 잡은 여러개의 스텝으로 이뤄짐
- 각 스템은 입력과 출력이 있음.

- 스프링 배치에서 잡 관리란
    - 한번만 처리되도록 할 수 있고
    - 재실행을 위한 잡의 상태 유지
    - 트랜잭션 관리해 잡 실패시 데이터 무결성 유지
    - 주세분석을 위해 과거 잡 실행의 성능 메트릭 저장

- 스프링 배치에서 로컬 원격 병렬화
    - 각 커밋 간격 내 처리를 스레드 풀에서 가져온 자체 스레드에서 처리 가능
    - 병렬 청크/스텝 처리
    - 원격 청크 처리,
    - 파티셔닝

- 스프링 에코 시스템
    - 스프링 부트
    - 스프링 클라우드 테스크
        - 정보성 메시지 (시작, 종료) 제공하는 기능
        - 배치 잡을 동적으로 확장가능
    - 스프링 클라우드 데이터 플로우
        - 잡의 시작 중지나 이전 잡의 실행 통계 관리
        - 클라우드 플랫폼에서 마이크로서비스를 오케스트레이션 하는 도구
    - 스프링 기능
        - AOP, DI, 트랜젝션 관리 등